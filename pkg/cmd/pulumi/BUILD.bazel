load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library", "go_test")

go_library(
    name = "pulumi_lib",
    srcs = [
        "about.go",
        "about_env.go",
        "ai.go",
        "ai_web.go",
        "cancel.go",
        "config.go",
        "console.go",
        "convert.go",
        "convert-trace.go",
        "crypto.go",
        "destroy.go",
        "doc.go",
        "env.go",
        "errors.go",
        "gen_completion.go",
        "gen_markdown.go",
        "import.go",
        "login.go",
        "logout.go",
        "logs.go",
        "main.go",
        "new.go",
        "org.go",
        "org_search.go",
        "org_search_ai.go",
        "package.go",
        "package_extract_mapping.go",
        "package_extract_schema.go",
        "package_gen_sdk.go",
        "package_pack_sdk.go",
        "package_publish.go",
        "plugin.go",
        "plugin_install.go",
        "plugin_ls.go",
        "plugin_rm.go",
        "policy.go",
        "policy_disable.go",
        "policy_enable.go",
        "policy_group_ls.go",
        "policy_ls.go",
        "policy_new.go",
        "policy_publish.go",
        "policy_rm.go",
        "policy_validate.go",
        "preview.go",
        "pulumi.go",
        "query.go",
        "refresh.go",
        "replay_events.go",
        "schema.go",
        "schema_check.go",
        "stack.go",
        "stack_change_secrets_provider.go",
        "stack_export.go",
        "stack_graph.go",
        "stack_history.go",
        "stack_import.go",
        "stack_init.go",
        "stack_ls.go",
        "stack_output.go",
        "stack_rename.go",
        "stack_rm.go",
        "stack_select.go",
        "stack_tag.go",
        "stack_unselect.go",
        "state.go",
        "state_delete.go",
        "state_edit.go",
        "state_edit_encoder.go",
        "state_rename.go",
        "state_unprotect.go",
        "state_upgrade.go",
        "terminal.go",
        "up.go",
        "util.go",
        "util_remote.go",
        "version.go",
        "view-trace.go",
        "watch.go",
        "whoami.go",
    ],
    importpath = "github.com/pulumi/pulumi/pkg/v3/cmd/pulumi",
    visibility = ["//visibility:private"],
    deps = [
        "@com_github_alecaivazis_survey_v2//:survey",
        "@com_github_alecaivazis_survey_v2//core",
        "@com_github_alecaivazis_survey_v2//terminal",
        "@com_github_blang_semver//:semver",
        "@com_github_djherbis_times//:times",
        "@com_github_dustin_go_humanize//:go-humanize",
        "@com_github_go_git_go_git_v5//:go-git",
        "@com_github_google_pprof//profile",
        "@com_github_google_shlex//:shlex",
        "@com_github_hashicorp_go_multierror//:go-multierror",
        "@com_github_hashicorp_hcl_v2//:hcl",
        "@com_github_kballard_go_shellquote//:go-shellquote",
        "@com_github_moby_moby//api/types/time",
        "@com_github_moby_term//:term",
        "@com_github_nbutton23_zxcvbn_go//:zxcvbn-go",
        "@com_github_opentracing_opentracing_go//:opentracing-go",
        "@com_github_pkg_browser//:browser",
        "@com_github_pulumi_esc//:esc",
        "@com_github_pulumi_esc//cmd/esc/cli",
        "@com_github_pulumi_pulumi_java_pkg//codegen/java",
        "//pkg/backend:go_default_library",
        "//pkg/backend/display:go_default_library",
        "//pkg/backend/filestate:go_default_library",
        "//pkg/backend/httpstate:go_default_library",
        "//pkg/backend/httpstate/client:go_default_library",
        "//pkg/backend/state:go_default_library",
        "//pkg/codegen/convert:go_default_library",
        "//pkg/codegen/dotnet:go_default_library",
        "//pkg/codegen/pcl:go_default_library",
        "//pkg/codegen/schema:go_default_library",
        "//pkg/engine:go_default_library",
        "//pkg/graph:go_default_library",
        "//pkg/graph/dotconv:go_default_library",
        "//pkg/importer:go_default_library",
        "//pkg/operations:go_default_library",
        "//pkg/resource/analyzer:go_default_library",
        "//pkg/resource/deploy:go_default_library",
        "//pkg/resource/deploy/providers:go_default_library",
        "//pkg/resource/edit:go_default_library",
        "//pkg/resource/graph:go_default_library",
        "//pkg/resource/stack:go_default_library",
        "//pkg/secrets:go_default_library",
        "//pkg/secrets/cloud:go_default_library",
        "//pkg/secrets/passphrase:go_default_library",
        "//pkg/util:go_default_library",
        "//pkg/util/afero:go_default_library",
        "//pkg/util/tracing:go_default_library",
        "//pkg/version:go_default_library",
        "//pkg/workspace:go_default_library",
        "//sdk/go/common/apitype:go_default_library",
        "//sdk/go/common/constant:go_default_library",
        "//sdk/go/common/diag:go_default_library",
        "//sdk/go/common/diag/colors:go_default_library",
        "//sdk/go/common/encoding:go_default_library",
        "//sdk/go/common/env:go_default_library",
        "//sdk/go/common/resource:go_default_library",
        "//sdk/go/common/resource/config:go_default_library",
        "//sdk/go/common/resource/plugin:go_default_library",
        "//sdk/go/common/slice:go_default_library",
        "//sdk/go/common/tokens:go_default_library",
        "//sdk/go/common/util/ciutil:go_default_library",
        "//sdk/go/common/util/cmdutil:go_default_library",
        "//sdk/go/common/util/contract:go_default_library",
        "//sdk/go/common/util/deepcopy:go_default_library",
        "//sdk/go/common/util/env:go_default_library",
        "//sdk/go/common/util/executable:go_default_library",
        "//sdk/go/common/util/gitutil:go_default_library",
        "//sdk/go/common/util/httputil:go_default_library",
        "//sdk/go/common/util/logging:go_default_library",
        "//sdk/go/common/util/result:go_default_library",
        "//sdk/go/common/workspace:go_default_library",
        "@com_github_pulumi_pulumi_yaml//pkg/pulumiyaml/codegen",
        "@com_github_shirou_gopsutil_v3//host",
        "@com_github_spf13_afero//:afero",
        "@com_github_spf13_cobra//:cobra",
        "@com_github_spf13_cobra//doc",
        "@com_github_spf13_pflag//:pflag",
        "@com_github_tweekmonster_luser//:luser",
        "@com_sourcegraph_sourcegraph_appdash//:appdash",
        "@com_sourcegraph_sourcegraph_appdash//traceapp",
        "@in_gopkg_yaml_v3//:yaml_v3",
        "@org_golang_x_term//:term",
        "@tech_pennock_go_tabular//auto",
    ],
)

go_binary(
    name = "pulumi",
    embed = [":pulumi_lib"],
    visibility = ["//visibility:public"],
)

go_test(
    name = "pulumi_test",
    srcs = [
        "about_test.go",
        "config_test.go",
        "convert_test.go",
        "import_test.go",
        "logs_test.go",
        "new_acceptance_test.go",
        "new_test.go",
        "org_search_ai_test.go",
        "org_search_test.go",
        "plugin_install_test.go",
        "policy_new_acceptance_test.go",
        "policy_new_test.go",
        "policy_publish_test.go",
        "pulumi_test.go",
        "stack_change_secrets_provider_test.go",
        "stack_init_test.go",
        "stack_ls_test.go",
        "stack_output_fuzz_test.go",
        "stack_output_test.go",
        "stack_test.go",
        "state_edit_test.go",
        "state_rename_test.go",
        "state_upgrade_test.go",
        "terminal_test.go",
        "up_test.go",
        "util_remote_test.go",
        "util_test.go",
        "whoami_test.go",
    ],
    data = glob(["testdata/**"]),
    embed = [":pulumi_lib"],
    deps = [
        "@com_github_blang_semver//:semver",
        "@com_github_creack_pty//:pty",
        "@com_github_hinshun_vt10x//:vt10x",
        "@com_github_netflix_go_expect//:go-expect",
        "@com_github_pkg_errors//:errors",
        "@com_github_pulumi_esc//:esc",
        "//pkg/backend:go_default_library",
        "//pkg/backend/display:go_default_library",
        "//pkg/backend/filestate:go_default_library",
        "//pkg/backend/httpstate:go_default_library",
        "//pkg/resource/deploy:go_default_library",
        "//pkg/resource/stack:go_default_library",
        "//pkg/secrets:go_default_library",
        "//pkg/secrets/b64:go_default_library",
        "//pkg/version:go_default_library",
        "//sdk/go/common/apitype:go_default_library",
        "//sdk/go/common/diag:go_default_library",
        "//sdk/go/common/encoding:go_default_library",
        "//sdk/go/common/env:go_default_library",
        "//sdk/go/common/resource:go_default_library",
        "//sdk/go/common/resource/config:go_default_library",
        "//sdk/go/common/testing:go_default_library",
        "//sdk/go/common/testing/diagtest:go_default_library",
        "//sdk/go/common/testing/iotest:go_default_library",
        "//sdk/go/common/tokens:go_default_library",
        "//sdk/go/common/util/env:go_default_library",
        "//sdk/go/common/util/gitutil:go_default_library",
        "//sdk/go/common/util/result:go_default_library",
        "//sdk/go/common/workspace:go_default_library",
        "@com_github_shirou_gopsutil_v3//host",
        "@com_github_spf13_cobra//:cobra",
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//require",
        "@in_gopkg_yaml_v3//:yaml_v3",
    ],
)
